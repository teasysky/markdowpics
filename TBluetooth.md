## 前言

目前iOS CoreBlueTooth相关的第三库已经有非常多，其中不乏非常优秀的封装库，如 [
BabyBluetooth](https://github.com/coolnameismy/BabyBluetooth) 和 [BluetoothKit](https://github.com/rhummelmose/BluetoothKit), 是 Objective-c 和 Swift 语言下最高Star的蓝牙封装框架。这两个库的共同优点是提供了非常简洁易用的API，高度抽象化蓝牙功能模块，框架中代码简洁、优雅。虽然有诸多优秀之处，但确不便于直接拿来主义，原因如下

- 冗余功能过多，包含蓝牙外围设备模块，融入于整个层次化抽象内，而我们只需要中心设备。
- 扩展性和业务调用方代码量的平衡问题，由于高扩展性，必然会带来业务代码量增加，这里需与业务复杂度达到一个平衡。
- 不便于扩展蓝牙协议通信，BLE通信的输入包括外设、服务、特征以及数据，除此之外还需要注意BLE连接状态，蓝牙权限等。而目前的框架侧重点在扫描，连接，发现服务和特征上，对于协议通信支持很弱或者没有支持。

针对于以上原因，我们需要一个功能复杂度适中、抽象层次恰当、通信协议扩展简洁的框架，这是设计TBluetooth的目的。

## 概述

该蓝牙框架主要包含两部分封装，分别是蓝牙核心层封装以及蓝牙通信协议封装。核心层提供了操作蓝牙必备的外部接口，事件监听以及代理回调，对非必须接口业务层无需关心，减少代码量。蓝牙通信协议封装提供了服务特征配置，协议代理，数据收发接口。对于业务层收发数据只需侧重关注数据本身，不需过多关注蓝牙操作层面的逻辑。

## 总体设计

TBluetooth 按照数据流方向分为三层，自顶而下为接口层、协议层和核心层，架构图如下：

<img src="./images/TBluetooth_1.png" width="500">




